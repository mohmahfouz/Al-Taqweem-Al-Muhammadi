<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>التقويم المحمدي</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/suncalc/1.9.0/suncalc.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Amiri', serif; background: linear-gradient(to bottom, #2E5B3F, #1B4D3E); color: #FDF6E3; margin: 0; padding: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        .main-container { background: rgba(245, 233, 214, 0.9); border-radius: 1.25rem; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.25); padding: 2.5rem; max-width: 28rem; width: 100%; text-align: center; position: relative; overflow: hidden; }
        .main-container::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-image: url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" opacity="0.05"%3E%3Ccircle cx="20" cy="20" r="10" fill="%23FDF6E3" fill-opacity="0.5"/%3E%3Cpath d="M50 10 L53 18 L61 18 L55 23 L57 31 L50 27 L43 31 L45 23 L39 18 L47 18 Z" fill="%23FDF6E3"/%3E%3Ccircle cx="80" cy="80" r="3" fill="%23FDF6E3"/%3E%3Ccircle cx="70" cy="30" r="2" fill="%23FDF6E3"/%3E%3Cpath d="M30 60 A20 20 0 0 1 10 60 A20 20 0 0 1 30 60 Z" fill="%23FDF6E3" stroke="%23FDF6E3" stroke-width="1"/%3E%3C/svg%3E'); background-size: 80px; pointer-events: none; }
        .title-container { display: flex; justify-content: center; align-items: center; gap: 1rem; margin-bottom: 1.5rem; }
        h1 { font-size: 3rem; color: #1B4D3E; margin: 0; }
        .subtitle { font-size: 1.5rem; color: #1B4D3E; margin: 0.5rem 0 0; }
        .save-link { color: #1B4D3E; font-size: 1rem; text-decoration: none; transition: color 0.3s ease; }
        .save-link:hover { color: #3A6F4A; text-decoration: underline; }
        select { background: #F5E9D6; border: 1px solid #1B4D3E; border-radius: 0.5rem; padding: 0.75rem; width: 100%; color: #1B4D3E; font-size: 1rem; margin-bottom: 0.5rem; transition: border-color 0.3s ease; }
        select option { color: #1B4D3E; background: #F5E9D6; }
        select:focus { border-color: #3A6F4A; outline: none; }
        input[type="date"] { background: #F5E9D6; border: 1px solid #1B4D3E; border-radius: 0.5rem; padding: 0.75rem; width: 100%; color: #1B4D3E; font-size: 1rem; margin-bottom: 0.5rem; transition: border-color 0.3s ease; }
        input[type="date"]:focus { border-color: #3A6F4A; outline: none; }
        #coordinates { font-size: 0.875rem; color: #0A2D4A; margin-bottom: 1rem; }
        .today-container { background: #1B4D3E; border-radius: 0.75rem; padding: 1rem; margin-bottom: 1.5rem; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15); }
        .today-container h3 { font-size: 1.5rem; color: #FDF6E3; margin: 0 0 0.5rem 0; }
        .today-container p { font-size: 1.125rem; color: #FDF6E3; margin: 0.5rem 0; }
        .time-card { background: #F5E9D6; border-radius: 1rem; padding: 1.25rem; margin-bottom: 1.5rem; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15); transition: transform 0.3s ease, box-shadow 0.3s ease; }
        .time-card:hover { transform: translateY(-5px); box-shadow: 0 6px 18px rgba(0, 0, 0, 0.2); }
        .time-card h2 { font-size: 1.25rem; color: #1B4D3E; margin-bottom: 0.5rem; }
        .time-card p { font-size: 1rem; color: #0A2D4A; margin: 0.25rem 0; }
        .info-container { background: #F5E9D6; border-radius: 1rem; padding: 1.25rem; margin-bottom: 1.5rem; font-size: 0.875rem; color: #0A2D4A; line-height: 1.6; }
        .conversion-container { background: #F5E9D6; border-radius: 1rem; padding: 1.25rem; margin-bottom: 1.5rem; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15); }
        .conversion-container h2 { font-size: 1.25rem; color: #1B4D3E; margin-bottom: 1rem; }
        .conversion-controls { display: flex; flex-wrap: wrap; gap: 0.5rem; justify-content: center; margin-bottom: 1rem; }
        .conversion-controls select, .conversion-controls input { flex: 1; min-width: 120px; }
        .conversion-result { background: #1B4D3E; border-radius: 0.75rem; padding: 1rem; color: #FDF6E3; margin-top: 1rem; }
        .conversion-result h3 { font-size: 1.5rem; color: #FDF6E3; margin: 1rem 0 0.5rem 0; }
        footer { font-size: 0.875rem; color: #0A2D4A; margin-top: 2rem; }
        .button-group { margin: 0.5rem 0; display: flex; flex-wrap: wrap; justify-content: center; gap: 0.5rem; }
        .button { font-size: 1rem; padding: 0.75rem; cursor: pointer; background: #1B4D3E; color: #FDF6E3; border: none; border-radius: 0.5rem; transition: background 0.3s ease, transform 0.2s ease; width: 100%; max-width: 100%; box-sizing: border-box; }
        .button:hover { background: #3A6F4A; transform: scale(1.05); }
        .inline-button { padding: 0.75rem; font-size: 1rem; }
        .inline-button.arrow { font-size: 1rem; padding: 0.75rem; }
        #slider, #time-slider { width: 90%; margin: 0.5rem auto; height: 8px; background: #3A6F4A; border-radius: 5px; outline: none; -webkit-appearance: none; }
        #slider::-webkit-slider-thumb, #time-slider::-webkit-slider-thumb { -webkit-appearance: none; width: 20px; height: 20px; background: #1B4D3E; border-radius: 50%; cursor: pointer; transition: transform 0.3s ease; }
        #slider::-webkit-slider-thumb:hover, #time-slider::-webkit-slider-thumb:hover { transform: scale(1.2); }
        #current-time { font-size: 1rem; color: #0A2D4A; margin-bottom: 0.5rem; }
        #remaining-time { font-size: 1rem; color: #3A6F4A; margin-bottom: 0.5rem; }
        .info-container a { color: #1B4D3E; text-decoration: none; display: block; margin: 0.5rem 0; transition: color 0.3s ease; }
        .info-container a:hover { color: #3A6F4A; text-decoration: underline; }
        .facebook-icon { width: 16px; height: 16px; vertical-align: middle; margin-left: 5px; }
        .conversion-navigation { margin-top: 1rem; }
        .occasion-info { font-style: italic; color: #F5E9D6; }
        .header-section { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; }
        .header-titles { text-align: right; }
        .mansion-nav { display: flex; justify-content: center; gap: 1rem; margin-top: 1rem; }
        .picker-group { flex: 1; min-width: 120px; display: flex; flex-direction: column; align-items: stretch; }
    </style>
</head>
<body>
    <div class="main-container">
        <div class="header-section">
            <div class="header-titles">
                <h1>التقويم المحمدي</h1>
                <p class="subtitle">مع مواقيت الصلاة و أداة للمقابلة</p>
            </div>
            <a href="index.html" download class="save-link">حفظ الصفحة</a>
        </div>
        
        <div class="today-container">
            <h3>اليوم</h3>
            <p id="muhammadan-date">--</p>
            <p id="gregorian-date">--</p>
            <p id="occasion-info" class="occasion-info">المناسبات: --</p>
            <h3>حركة الشمس فى منازلها</h3>
            <p id="today-mansion-info-rising">الطالع بالغداة: --</p>
            <p id="today-mansion-info-setting">الغارب بالغداة: --</p>
            <p id="today-mansion-info-quote">يقول ساجع العرب: --</p>
        </div>
        
        <div class="info-container">
            <p>التقويم المحمدى هو نتيجة بحث السيد الأستاذ فرقد الحسينى القزوينى دام فيضه: لا علاقة له بحركة القمر. بل هو: تقويم شمسى نجمى يعتمد على حركة الشمس فى منازلها لمعرفة مواقع الشهور فى الفصول أولا. ومعرفة عدد السنين. المصدر كتاب فيض العليم في معرفة التقويم للسيد الأستاذ فرقد الحسيني القزويني</p>
            <a href="https://drive.google.com/file/d/1KonLhpZ8gsSPl1UlbjyxGm1kHHQaQmTQ/view?fbclid=IwY2xjawM3-HtleHRuA2FlbQIxMABicmlkETEyZWVrR0RZejFUYzN5T0FVAR4YHrEAXzr9WSySCkqQLw0HDZshjLcBYhl22b9EPQJtHh1tNdliO_PRcPQdEQ_aem_yCNWTOaAr28eYVfRsxK3dw">التقويم المحمدي السنوي في الرابط التالي</a>
            <a href="https://books.google.com.eg/books/about/%D9%81%D9%8A%D8%B6_%D8%A7%D9%84%D8%B9%D9%84%D9%8A%D9%85_%D9%81%D9%8A_%D9%85%D8%B9%D8%B1%D9%81%D8%A9_%D8%A7%D9%84.html?id=OyO1EAAAQBAJ&redir_esc=y">رابط كتاب فيض العليم فى معرفة التقويم</a>
            <a href="https://www.facebook.com/AlhillaNgo" title="مؤسسة الحلة للدراسات الإنسانية والعلمية والدينية/ بابل">
                <svg class="facebook-icon" viewBox="0 0 24 24" fill="#1B4D3E">
                    <path d="M12 2.04c-5.5 0-10 4.49-10 10 0 4.99 3.66 9.13 8.44 9.88v-6.98h-2.54v-2.9h2.54v-2.21c0-2.51 1.49-3.89 3.78-3.89 1.09 0 2.24.19 2.24.19v2.47h-1.26c-1.24 0-1.63.77-1.63 1.56v1.88h2.77l-.44 2.9h-2.33v6.98c4.78-.75 8.44-4.89 8.44-9.88 0-5.51-4.5-10-10-10z"/>
                </svg>
                مؤسسة الحلة للدراسات الإنسانية والعلمية والدينية/ بـــــابـــــــل
            </a>
        </div>
        
        <div id="solar-times">
            <div class="time-card">
                <select id="city-select" aria-label="اختر المدينة">
                    <option value="najaf" selected>النجف، العراق</option>
                    <option value="karbala">كربلاء، العراق</option>
                    <option value="al_hilla">الحلة، العراق</option>
                    <option value="cairo">القاهرة، مصر</option>
                    <option value="alexandria">الإسكندرية، مصر</option>
                    <option value="port_said">بورسعيد، مصر</option>
                </select>
                <p id="coordinates">الإحداثيات: --</p>
                <p id="current-time">--</p>
                <input type="range" id="time-slider" min="0" max="1439" value="0">
                <p id="remaining-time">--</p>
                <h2>مواقيت الصلاة</h2>
                <p><strong>الإمساك</strong>: <span id="astronomical-dawn">--</span></p>
                <p><strong>صلاة الفجر</strong>: <span id="nautical-twilight-start">--</span></p>
                <p><strong>طلوع الشمس</strong>: <span id="sunrise">--</span></p>
                <p><strong>صلاة الظهر</strong>: <span id="solar-noon">--</span></p>
                <p><strong>غروب الشمس</strong>: <span id="sunset">--</span></p>
                <p><strong>صلاة المغرب</strong>: <span id="civil-twilight-end">--</span></p>
                <p><strong>وقت الإفطار</strong>: <span id="iftar">--</span></p>
                <p><strong>منتصف الليل</strong>: <span id="night-prayer">--</span></p>
            </div>
        </div>
        
        <div class="conversion-container">
            <h2>المقابلة بين التقويم المحمدي والتقويم الشمسي الحالي (الميلادي)</h2>
            
            <div class="conversion-navigation">
                <div class="conversion-controls">
                    <div class="picker-group">
                        <button id="prevDay" class="button inline-button arrow">اليوم السابق</button>
                        <select id="conversion-custom-day"></select>
                        <button id="nextDay" class="button inline-button arrow">اليوم التالي</button>
                    </div>
                    <div class="picker-group">
                        <button id="prevCustomMonth" class="button inline-button">الشهر السابق</button>
                        <select id="conversion-custom-month"></select>
                        <button id="nextCustomMonth" class="button inline-button">الشهر القادم</button>
                    </div>
                    <div class="picker-group">
                        <button id="prevYear" class="button inline-button">العام السابق</button>
                        <select id="conversion-custom-year"></select>
                        <button id="nextYear" class="button inline-button">العام القادم</button>
                    </div>
                </div>
                <div class="conversion-controls">
                    <input type="date" id="conversion-gregorian-picker" min="0620-01-01" max="2089-12-31">
                </div>
                <input type="range" id="slider" min="0" max="364" value="0">
                <div class="reset-button-container">
                    <button id="resetDay" class="button">إعادة ضبط اليوم</button>
                </div>
            </div>
            
            <div class="conversion-result">
                <p id="conversion-muhammadan-date">--</p>
                <p id="conversion-gregorian-date">--</p>
                <p id="conversion-occasion">--</p>
                <h3>حركة الشمس فى منازلها</h3>
                <p id="conversion-mansion-info-rising">الطالع بالغداة: --</p>
                <p id="conversion-mansion-info-setting">الغارب بالغداة: --</p>
                <p id="conversion-mansion-info-quote">يقول ساجع العرب: --</p>
                <div class="mansion-nav">
                    <button id="conversion-prevMansion" class="button inline-button">المنزلة السابقة</button>
                    <button id="conversion-nextMansion" class="button inline-button">المنزلة التالية</button>
                </div>
            </div>
        </div>
        
        <footer>2025 © اسم المصمم: محمد محفوظ</footer>
    </div>

    <script>
        const cities = {
            najaf: { lat: 32.0259, lng: 44.3462, name: 'النجف، العراق' },
            karbala: { lat: 32.6060, lng: 44.0249, name: 'كربلاء، العراق' },
            al_hilla: { lat: 32.4637, lng: 44.4198, name: 'الحلة، العراق' },
            cairo: { lat: 30.0444, lng: 31.2357, name: 'القاهرة، مصر' },
            alexandria: { lat: 31.2001, lng: 29.9187, name: 'الإسكندرية، مصر' },
            port_said: { lat: 31.2565, lng: 32.2841, name: 'بورسعيد، مصر' }
        };
        const months = ["رمضان", "شوال", "جمادى الأولى", "جمادى الآخرة", "رجب", "ربيع الأول", "ربيع الآخر", "ذي القعدة", "ذي الحجة", "محرم", "صفر", "شعبان"];
        const baseSpecialDays = ["يوم التقويم الأول", "يوم التقويم الثاني", "يوم التقويم الثالث", "يوم التقويم الرابع", "يوم التقويم الخامس"];
        const selectedTimezone = "Africa/Cairo"; // Updated for Najaf, Iraq (EEST)
        const syriacMonths = ['كانون الثاني', 'شباط', 'آذار', 'نيسان', 'أيار', 'حزيران', 'تموز', 'آب', 'أيلول', 'تشرين الأول', 'تشرين الثاني', 'كانون الأول'];
        const occasions = [
            {month: "رمضان", day: "1", occasion: "ليلة القدر"},
            {month: "رمضان", day: "10", occasion: "وفاة السيدة خديجة عليها السلام"},
            {month: "رمضان", day: "15", occasion: "ميلاد الإمام الحسن بن ابي طالب عليه السلام"},
            {month: "رمضان", day: "19", occasion: "جرح أمير المؤمنين عليه السلام"},
            {month: "رمضان", day: "21", occasion: "إستشهاد الإمام علي بن ابي طالب عليه السلام"},
            {month: "شوال", day: "1", occasion: "عيد الفطر"},
            {month: "شوال", day: "15", occasion: "معركة احد واستشهاد الحمزة عليه السلام"},
            {month: "شوال", day: "25", occasion: "إستشهاد الإمام جعفر الصادق عليه السلام"},
            {month: "جمادى الأولى", day: "5", occasion: "ولادة السيدة زينب بنت علي بن ابي طالب عليه السلام سنة 5 هجري"},
            {month: "جمادى الأولى", day: "13", occasion: "استشهاد فاطمه الزهراء عليها السلام على رواية"},
            {month: "جمادى الآخرة", day: "3", occasion: "وفاة السيدة فاطمة الزهراء عليها السلام على رواية"},
            {month: "جمادى الآخرة", day: "13", occasion: "وفاة أم البنين عليها السلام"},
            {month: "جمادى الآخرة", day: "20", occasion: "ولادة فاطمة الزهراء عليها السلام"},
            {month: "رجب", day: "1", occasion: "ولادة الإمام علي بن محمد الباقر عليه السلام"},
            {month: "رجب", day: "2", occasion: "وفاة الإمام علي بن محمد الهادي عليه السلام"},
            {month: "رجب", day: "3", occasion: "ولادة الإمام علي بن محمد الهادي عليه السلام"},
            {month: "رجب", day: "10", occasion: "ولادة الإمام محمد بن علي الجواد عليه السلام"},
            {month: "رجب", day: "13", occasion: "ولادة الإمام علي بن ابي طالب عليه السلام"},
            {month: "رجب", day: "15", occasion: "وفاة السيدة زينب بنت علي عليهما السلام"},
            {month: "رجب", day: "25", occasion: "استشهاد الامام الكاظم عليه السلام"},
            {month: "رجب", day: "26", occasion: "وفاة ابي طالب عليه السلام"},
            {month: "رجب", day: "27", occasion: "بعثة النبي صلى الله عليه و آله و سلم"},
            {month: "ربيع الأول", day: "8", occasion: "شهادة الامام الحسن العسكري عليه السلام"},
            {month: "ربيع الأول", day: "10", occasion: "وفاة عبد المطلب عليه السلام"},
            {month: "ربيع الأول", day: "12", occasion: "ولادة النبي صلى الله عليه و آله على رواية"},
            {month: "ربيع الأول", day: "17", occasion: "ولادة النبي صلى الله عليه و آله وولادة الإمام جعفر الصادق عليه السلام"},
            {month: "ربيع الآخر", day: "8", occasion: "شهادة السيدة فاطمة الزهراء عليها السلام على رواية"},
            {month: "ربيع الآخر", day: "10", occasion: "ولادة الإمام الحسن العسكري عليه السلام"},
            {month: "ذي القعدة", day: "11", occasion: "ولادة الإمام علي بن موسى الرضا عليه السلام"},
            {month: "ذي القعدة", day: "25", occasion: "يوم دحو الأرض"},
            {month: "ذي القعدة", day: "آخر الشهر", occasion: "شهادة الامام محمد الجواد عليه السلام"},
            {month: "ذي الحجة", day: "1", occasion: "زواج امير المؤمنين عليه السلام من فاطمة الزهراء عليها السلام"},
            {month: "ذي الحجة", day: "7", occasion: "شهادة الامام الباقر عليه السلام"},
            {month: "ذي الحجة", day: "9", occasion: "شهادة مسلم بن عقيل عليه السلام"},
            {month: "ذي الحجة", day: "10", occasion: "عيد الأضحى"},
            {month: "ذي الحجة", day: "18", occasion: "عيد الغدير"},
            {month: "ذي الحجة", day: "24", occasion: "يوم المباهلة"},
            {month: "محرم", day: "10", occasion: "يوم إستشهاد الحسين عليه السلام"},
            {month: "محرم", day: "25", occasion: "إستشهاد الإمام علي بن الحسين عليه السلام"},
            {month: "صفر", day: "3", occasion: "والدة الإمام الباقر عليه السلام"},
            {month: "صفر", day: "7", occasion: "إستشهاد الإمام الحسن بن علي عليه السلام"},
            {month: "صفر", day: "20", occasion: "أربعين الإمام الحسين عليه السلام"},
            {month: "صفر", day: "28", occasion: "إستشهاد النبي صلى الله عليه و آله"},
            {month: "صفر", day: "آخر الشهر", occasion: "إستشهاد الإمام الرضا عليه السلام"},
            {month: "شعبان", day: "3", occasion: "ولادة الإمام الحسين عليه السلام"},
            {month: "شعبان", day: "4", occasion: "ولادة العباس عليه السلام"},
            {month: "شعبان", day: "5", occasion: "ولادة الإمام علي بن الحسين عليه السلام"},
            {month: "شعبان", day: "15", occasion: "ولادة الإمام المهدي عليه السلام"}
        ];
        const mansions = [
            {"التاريخ": "2025-01-02", "الطالع بالغداة": "الشولة", "الغارب بالغداة": "الهقعة", "يقول ساجع العرب": "اذا طلعت الشولة اعجلت الشيخ البولة واشتدت على العائل العولة"},
            {"التاريخ": "2025-01-15", "الطالع بالغداة": "النعائم", "الغارب بالغداة": "الهنعة", "يقول ساجع العرب": "اذا طلعت النعائم توسفت التهائم وخلص البرد الى كل نائم وتلاقى الرعاء بالنمائم"},
            {"التاريخ": "2025-01-28", "الطالع بالغداة": "البلدة", "الغارب بالغداة": "الذراع", "يقول ساجع العرب": "اذا طلعت البلده حممت الجعده واكلت القشده وقيل للبرد اهده"},
            {"التاريخ": "2025-02-10", "الطالع بالغداة": "سعد الذابح", "الغارب بالغداة": "النثرة", "يقول ساجع العرب": "اذا طلع سعد الذابح حمى اهله النابح ونفع اهله الرائح وتصبح السارح وظهر فى الحى الانافح"},
            {"التاريخ": "2025-02-23", "الطالع بالغداة": "سعد بلع", "الغارب بالغداة": "الطرفة", "يقول ساجع العرب": "اذا طلع سعد بلع اقتحم الربع ولحق الهبع وصيد المرع وصار فى الارض لمع"},
            {"التاريخ": "2025-03-08", "الطالع بالغداة": "سعد السعود", "الغارب بالغداة": "الجبهة", "يقول ساجع العرب": "اذا طلع سعد السعود نظر العود ولانت الجلود وذاب كل محمود وكره الناس فى الشمس القعود"},
            {"التاريخ": "2025-03-21", "الطالع بالغداة": "سعد الأخبية", "الغارب بالغداة": "الزبرة", "يقول ساجع العرب": "اذا طلع سعد الاخبية دهنت الاسقيه ونزلت الاحوية وتجاورت الابنيه"},
            {"التاريخ": "2025-04-03", "الطالع بالغداة": "الفرغ الأول", "الغارب بالغداة": "الصرفة", "يقول ساجع العرب": "اذا طلع الدلو هيب الجزو وانسل العفو وطلب اللهو الخلو"},
            {"التاريخ": "2025-04-16", "الطالع بالغداة": "الفرغ المؤخر", "الغارب بالغداة": "السماك", "يقول ساجع العرب": "اذا طلع الدلو هيب الجزو وانسل العفو وطلب اللهو الخلو"},
            {"التاريخ": "2025-04-29", "الطالع بالغداة": "السمكة", "الغارب بالغداة": "السماك", "يقول ساجع العرب": "اذا طلعت السمكه نصبت الشبكه وامكنت الحركه وتعلقت بالثوب الحسكه وطاب الزمان للنسكه"},
            {"التاريخ": "2025-05-12", "الطالع بالغداة": "الشرطان", "الغارب بالغداة": "الغفر", "يقول ساجع العرب": "اذا طلع الشرطان استوى الزمان وحضرت الاوطان وتهادى الجيران"},
            {"التاريخ": "2025-05-25", "الطالع بالغداة": "البطين", "الغارب بالغداة": "الزبانى", "يقول ساجع العرب": "اذا طلع البطين اقتضى الدين وظهر الزين واقتفى بالعطار و الزين"},
            {"التاريخ": "2025-06-07", "الطالع بالغداة": "الثريا", "الغارب بالغداة": "الإكليل", "يقول ساجع العرب": "اذا طلع النجم فالحر فى حدم و العشب فى حطم والعانات فى كدم"},
            {"التاريخ": "2025-06-20", "الطالع بالغداة": "الدبران", "الغارب بالغداة": "القلب", "يقول ساجع العرب": "اذا طلعت الدبران توقدت الحزان وكرهت النيران واستعرت الذبان وبيست الغدران ورمت بانفسها حيث شاءت الصبيان"},
            {"التاريخ": "2025-07-03", "الطالع بالغداة": "الهقعة", "الغارب بالغداة": "الشولة", "يقول ساجع العرب": "اذا طلعت الهقعة تقوضت الناس للقلعة ورجعوا عن النجعه واردفتها الهنعة"},
            {"التاريخ": "2025-07-16", "الطالع بالغداة": "الهنعة", "الغارب بالغداة": "النعائم", "يقول ساجع العرب": "اذا طلعت الجوزاء توقدت المعزاء وكنست الضباء وعرقت العلباء وطاب الخباء"},
            {"التاريخ": "2025-07-29", "الطالع بالغداة": "الذراع", "الغارب بالغداة": "البلدة", "يقول ساجع العرب": "اذا طلعت الذراع حسرت الشمس القناع واشعلت فى الافق الشعاع وترقرق السراب بكل قاع"},
            {"التاريخ": "2025-08-11", "الطالع بالغداة": "النثرة", "الغارب بالغداة": "سعد الذابح", "يقول ساجع العرب": "اذا طلعت النثرة قنأة البسرة وجنى النخل بكره وأوت المواشى حجره ولم تترك ف ذات در قطره"},
            {"التاريخ": "2025-08-24", "الطالع بالغداة": "الطرف", "الغارب بالغداة": "سعد بلع", "يقول ساجع العرب": "اذا طلعت الطرفة بكرت الخرفة وكثرت الطرفة وهانت للضيف الكلفة"},
            {"التاريخ": "2025-09-06", "الطالع بالغداة": "الجبهة", "الغارب بالغداة": "سعد السعود", "يقول ساجع العرب": "اذا طلعت الجبهة تحانت الولهه وتنازت السفهة وقلت فى الارض الرفهة"},
            {"التاريخ": "2025-09-20", "الطالع بالغداة": "الزبرة", "الغارب بالغداة": "سعد الأخبية", "يقول ساجع العرب": "اذا طلعت الزبرة طاب الزمان جنى البسر فى كل مكان"},
            {"التاريخ": "2025-10-03", "الطالع بالغداة": "الصرفة", "الغارب بالغداة": "الفرغ الأول", "يقول ساجع العرب": "اذا طلعت الصرفة احتال كل ذي حرفة وجفر كل ذي نطفة وامتيز عن المياه زلفه"},
            {"التاريخ": "2025-10-16", "الطالع بالغداة": "العواء", "الغارب بالغداة": "الفرغ المؤخر", "يقول ساجع العرب": "إذا طلعت العواء ضرب الخباء وطاب الهواء وكره العراء وشنن السقاء"},
            {"التاريخ": "2025-10-29", "الطالع بالغداة": "السماك", "الغارب بالغداة": "السمكة", "يقول ساجع العرب": "لذا طلع السماك ذهب العكاك وقل على الماء اللكاك"},
            {"التاريخ": "2025-11-11", "الطالع بالغداة": "الغفر", "الغارب بالغداة": "الشرطان", "يقول ساجع العرب": "اذا طلع الغفر اقشعر السفر وتربل النضر وحسن فى العين الجمر"},
            {"التاريخ": "2025-11-24", "الطالع بالغداة": "الزبانى", "الغارب بالغداة": "البطين", "يقول ساجع العرب": "اذا طلعت الزبانى احدثت لكل ذي عيال شانا ولكل ذي mاشية هوانا"},
            {"التاريخ": "2025-12-07", "الطالع بالغداة": "الإكليل", "الغارب بالغداة": "الثريا", "يقول ساجع العرب": "اذا طلع الإكليل هاجت الفحول وتخوفت السيول"},
            {"التاريخ": "2025-12-20", "الطالع بالغداة": "القلب", "الغارب بالغداة": "الدبران", "يقول ساجع العرب": "اذا طلع القلب جاء الشتاء كالكلب وصار اهل البوادي فى كرب ولا يمكن الفحل الا ذات ثرب"}
        ];
        let todayGregYear = 2025;
        let todayIndex = 0;
        let baseGregYear = 2025;
        let baseIndex = 0;
        let simulatedTime = null;
        let isPickerChange = false;

        function isLeapYear(year) {
            return (year % 4 === 0 && year % 100 !== 0) || (year % 400 === 0);
        }

        function getTodayIndexAndYear() {
            const today = new Date();
            let year = today.getFullYear();
            const calendarStart = new Date(year, 9, 16);
            if (today < calendarStart) year--;
            const timeDiff = today - new Date(year, 9, 16);
            const daysDiff = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
            return { index: daysDiff, year };
        }

        function getCustomDate(index, year) {
            const baseDate = new Date(year, 9, 16);
            baseDate.setDate(baseDate.getDate() + index);
            const dayOfWeek = baseDate.toLocaleDateString('ar-EG', { weekday: 'long', timeZone: selectedTimezone });
            const gregYear = baseDate.getFullYear();
            const customYear = 1404 + (year - 2024);
            const isEndYearLeap = isLeapYear(year + 1);
            const specialDays = isEndYearLeap ? [...baseSpecialDays, "يوم التقويم السادس"] : [...baseSpecialDays];
            let dayName = index >= 360 ? specialDays[index - 360] : `${(index % 30) + 1} ${months[Math.floor(index / 30)]}`;
            const dayNum = baseDate.getDate();
            const monthNum = baseDate.getMonth();
            const syriacMonth = syriacMonths[monthNum];
            const gregorianDate = `الموافق ${dayNum} ${syriacMonth} ${gregYear} (التقويم الشمسي الحالي)`;
            return { text: `${dayOfWeek} ${dayName} لسنة ${customYear} من الهجرة (تقويم محمدى)`, date: baseDate, gregorian: gregorianDate, year: customYear };
        }

        function getOccasion(index, year) {
            const isEndYearLeap = isLeapYear(year + 1);
            const specialDays = isEndYearLeap ? [...baseSpecialDays, "يوم التقويم السادس"] : [...baseSpecialDays];
            const currentMonth = index >= 360 ? null : months[Math.floor(index / 30)];
            const currentDay = index >= 360 ? specialDays[index - 360] : (index % 30) + 1;
            for (const occ of occasions) {
                if (currentMonth && occ.month === currentMonth && occ.day == currentDay) return occ.occasion;
                if (occ.day === "آخر الشهر" && ((index === 359 && occ.month === currentMonth) || (index === (isEndYearLeap ? 365 : 364) && currentDay === (isEndYearLeap ? "يوم التقويم السادس" : "يوم التقويم الخامس")))) return occ.occasion;
            }
            return null;
        }

        function getMansionInfo(index, year) {
            const isEndYearLeap = isLeapYear(year + 1);
            if (isEndYearLeap && index === 365) return mansions[27];
            const cycleIndex = index % 365;
            const baseDate = new Date(2024, 9, 16);
            const ranges = mansions.map((mansion, i) => {
                const date = new Date(mansion["التاريخ"]);
                const timeDiff = date - baseDate;
                const startIndex = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
                const isJabha = mansion["الطالع بالغداة"] === "الجبهة";
                const endIndex = startIndex + (isJabha ? 13 : 12);
                return { start: startIndex % 365, end: endIndex % 365, mansion, index: i };
            });
            for (const range of ranges) {
                if (range.start <= range.end && cycleIndex >= range.start && cycleIndex <= range.end) return { ...range.mansion, rangeIndex: range.index };
                if (range.start > range.end && (cycleIndex >= range.start || cycleIndex <= range.end)) return { ...range.mansion, rangeIndex: range.index };
            }
            return null;
        }

        function formatTime(date) {
            if (isNaN(date.getTime())) return '--';
            return date.toLocaleTimeString('ar-EG', { timeZone: selectedTimezone, hour12: false, hour: '2-digit', minute: '2-digit', second: '2-digit' });
        }

        function formatRemainingTime(milliseconds) {
            const totalSeconds = Math.floor(milliseconds / 1000);
            const hours = Math.floor(totalSeconds / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const seconds = totalSeconds % 60;
            return `${hours} ساعة ${minutes} دقيقة ${seconds} ثانية`;
        }

        function getTimeAtAltitude(date, lat, lng, targetAltitudeDegrees, startTime) {
            const targetAltitude = targetAltitudeDegrees * Math.PI / 180;
            let low = startTime.getTime();
            let high = low + 2 * 60 * 60 * 1000;
            while (high - low > 1000) {
                const mid = (low + high) / 2;
                const midDate = new Date(mid);
                const position = SunCalc.getPosition(midDate, lat, lng);
                if (position.altitude > targetAltitude) {
                    low = mid;
                } else {
                    high = mid;
                }
            }
            return new Date(low);
        }

        function getPrayerTimes(date, lat, lng) {
            const times = SunCalc.getTimes(date, lat, lng);
            const sunset = times.sunset;
            const tomorrow = new Date(date);
            tomorrow.setDate(tomorrow.getDate() + 1);
            const nextNauticalDawn = SunCalc.getTimes(tomorrow, lat, lng).nauticalDawn;
            const difference = nextNauticalDawn.getTime() - sunset.getTime();
            const half = difference / 2;
            const nightPrayer = new Date(sunset.getTime() + half);
            let ishaTime = getTimeAtAltitude(date, lat, lng, -4, sunset);
            ishaTime = new Date(ishaTime.getTime() + 2 * 60 * 1000);
            const iftar = new Date(ishaTime.getTime() + 15 * 60 * 1000);
            return {
                astronomicalDawn: times.nightEnd,
                nauticalDawn: times.nauticalDawn,
                sunrise: times.sunrise,
                solarNoon: times.solarNoon,
                sunset: sunset,
                civilTwilightEnd: ishaTime,
                iftar: iftar,
                nightPrayer: nightPrayer
            };
        }

        function getNextPrayerTime(currentTime, prayerTimes, date, lat, lng) {
            const prayerList = [
                { name: 'الإمساك', display: 'الإمساك', time: prayerTimes.astronomicalDawn },
                { name: 'صلاة الفجر', display: 'صلاة الفجر', time: prayerTimes.nauticalDawn },
                { name: 'طلوع الشمس', display: 'طلوع الشمس', time: prayerTimes.sunrise },
                { name: 'صلاة الظهر', display: 'صلاة الظهر', time: prayerTimes.solarNoon },
                { name: 'غروب الشمس', display: 'غروب الشمس', time: prayerTimes.sunset },
                { name: 'صلاة المغرب', display: 'صلاة المغرب', time: prayerTimes.civilTwilightEnd },
                { name: 'وقت الإفطار', display: 'وقت الإفطار', time: prayerTimes.iftar },
                { name: 'منتصف الليل', display: 'منتصف الليل', time: prayerTimes.nightPrayer }
            ];

            const currentTimeMs = currentTime.getTime();
            let minDiff = Infinity;
            let nextPrayer = null;

            // Check current day's prayer times
            for (const prayer of prayerList) {
                if (!prayer.time || isNaN(prayer.time.getTime())) continue;
                const prayerMs = prayer.time.getTime();
                const diff = prayerMs - currentTimeMs;
                if (diff > 0 && diff < minDiff) {
                    minDiff = diff;
                    nextPrayer = prayer;
                }
            }

            // If no future prayer is found for the current day, check the next day's prayers
            if (!nextPrayer) {
                const tomorrow = new Date(date);
                tomorrow.setDate(tomorrow.getDate() + 1);
                const tomorrowPrayerTimes = getPrayerTimes(tomorrow, lat, lng);
                const tomorrowList = [
                    { name: 'الإمساك', display: 'الإمساك', time: tomorrowPrayerTimes.astronomicalDawn },
                    { name: 'صلاة الفجر', display: 'صلاة الفجر', time: tomorrowPrayerTimes.nauticalDawn }
                ];

                for (const prayer of tomorrowList) {
                    if (!prayer.time || isNaN(prayer.time.getTime())) continue;
                    const prayerMs = prayer.time.getTime();
                    const diff = prayerMs - currentTimeMs;
                    if (diff > 0 && diff < minDiff) {
                        minDiff = diff;
                        nextPrayer = prayer;
                    }
                }
            }

            // If still no prayer is found, default to next day's Imsak
            if (!nextPrayer) {
                const tomorrow = new Date(date);
                tomorrow.setDate(tomorrow.getDate() + 1);
                const tomorrowPrayerTimes = getPrayerTimes(tomorrow, lat, lng);
                nextPrayer = { name: 'الإمساك', display: 'الإمساك', time: tomorrowPrayerTimes.astronomicalDawn };
                minDiff = tomorrowPrayerTimes.astronomicalDawn.getTime() - currentTimeMs;
            }

            return { name: nextPrayer.display, time: nextPrayer.time, remaining: minDiff };
        }

        function updateTodaySection() {
            const { text, gregorian, date } = getCustomDate(todayIndex, todayGregYear);
            document.getElementById('muhammadan-date').textContent = text;
            document.getElementById('gregorian-date').textContent = gregorian;
            const occasion = getOccasion(todayIndex, todayGregYear);
            document.getElementById('occasion-info').textContent = occasion ? `المناسبات: ${occasion}` : 'المناسبات: لا يوجد';
            const mansion = getMansionInfo(todayIndex, todayGregYear);
            document.getElementById('today-mansion-info-rising').textContent = mansion ? `الطالع بالغداة: ${mansion["الطالع بالغداة"]}` : 'الطالع بالغداة: --';
            document.getElementById('today-mansion-info-setting').textContent = mansion ? `الغارب بالغداة: ${mansion["الغارب بالغداة"]}` : 'الغارب بالغداة: --';
            document.getElementById('today-mansion-info-quote').textContent = mansion ? `يقول ساجع العرب: ${mansion["يقول ساجع العرب"]}` : 'يقول ساجع العرب: --';
            const currentUTC = simulatedTime || new Date();
            document.getElementById('current-time').textContent = `الوقت الآن: ${formatTime(currentUTC)}`;
            const selectedCity = document.getElementById('city-select').value;
            const city = cities[selectedCity];
            const prayerTimes = getPrayerTimes(date, city.lat, city.lng);
            const nextPrayer = getNextPrayerTime(currentUTC, prayerTimes, date, city.lat, city.lng);
            document.getElementById('remaining-time').textContent = `متبقى ${formatRemainingTime(nextPrayer.remaining)} على ${nextPrayer.name}`;
        }

        function updatePrayerTimes() {
            const selectedCity = document.getElementById('city-select').value;
            const city = cities[selectedCity];
            const { date } = getCustomDate(todayIndex, todayGregYear);
            const prayerTimes = getPrayerTimes(date, city.lat, city.lng);
            document.getElementById('astronomical-dawn').textContent = formatTime(prayerTimes.astronomicalDawn);
            document.getElementById('nautical-twilight-start').textContent = formatTime(prayerTimes.nauticalDawn);
            document.getElementById('sunrise').textContent = formatTime(prayerTimes.sunrise);
            document.getElementById('solar-noon').textContent = formatTime(prayerTimes.solarNoon);
            document.getElementById('sunset').textContent = formatTime(prayerTimes.sunset);
            document.getElementById('civil-twilight-end').textContent = formatTime(prayerTimes.civilTwilightEnd);
            document.getElementById('iftar').textContent = formatTime(prayerTimes.iftar);
            document.getElementById('night-prayer').textContent = formatTime(prayerTimes.nightPrayer);
            document.getElementById('coordinates').textContent = `الإحداثيات: ${city.lat.toFixed(4)}° شمالاً، ${city.lng.toFixed(4)}° شرقاً`;
        }

        function populateConversionPickers() {
            const customMonth = document.getElementById('conversion-custom-month');
            const customDay = document.getElementById('conversion-custom-day');
            const customYear = document.getElementById('conversion-custom-year');
            customMonth.innerHTML = '<option value="">اختر الشهر</option>';
            months.forEach((month, i) => customMonth.innerHTML += `<option value="${i}">${month}</option>`);
            customMonth.innerHTML += `<option value="special">أيام التقويم</option>`;
            for (let y = 1340; y <= 1500; y++) customYear.innerHTML += `<option value="${y}">${y}</option>`;
            function updateConversionDays() {
                const monthValue = customMonth.value;
                customDay.innerHTML = '<option value="">اختر اليوم</option>';
                if (monthValue === "") return;
                if (monthValue === "special") {
                    const isEndYearLeap = isLeapYear(baseGregYear + 1);
                    const maxDays = isEndYearLeap ? 6 : 5;
                    const specialDays = isEndYearLeap ? [...baseSpecialDays, "يوم التقويم السادس"] : [...baseSpecialDays];
                    for (let i = 1; i <= maxDays; i++) customDay.innerHTML += `<option value="${i}">${specialDays[i - 1]}</option>`;
                } else {
                    for (let i = 1; i <= 30; i++) customDay.innerHTML += `<option value="${i}">${i}</option>`;
                }
            }
            customMonth.addEventListener('change', updateConversionDays);
            updateConversionDays();
        }

        function updateConversionDisplay() {
            const { text, gregorian, date, year } = getCustomDate(baseIndex, baseGregYear);
            document.getElementById('conversion-muhammadan-date').textContent = text;
            document.getElementById('conversion-gregorian-date').textContent = gregorian;
            const occasion = getOccasion(baseIndex, baseGregYear);
            document.getElementById('conversion-occasion').textContent = occasion ? `المناسبات: ${occasion}` : 'المناسبات: لا يوجد';
            if (!isPickerChange) {
                const customMonth = document.getElementById('conversion-custom-month');
                const customDay = document.getElementById('conversion-custom-day');
                const customYear = document.getElementById('conversion-custom-year');
                const isEndYearLeap = isLeapYear(baseGregYear + 1);
                if (baseIndex >= 360) {
                    customMonth.value = "special";
                    const maxDays = isEndYearLeap ? 6 : 5;
                    const specialDays = isEndYearLeap ? [...baseSpecialDays, "يوم التقويم السادس"] : [...baseSpecialDays];
                    customDay.innerHTML = '<option value="">اختر اليوم</option>';
                    for (let i = 1; i <= maxDays; i++) customDay.innerHTML += `<option value="${i}">${specialDays[i - 1]}</option>`;
                    customDay.value = baseIndex - 359;
                } else {
                    const monthIndex = Math.floor(baseIndex / 30);
                    const day = (baseIndex % 30) + 1;
                    customMonth.value = monthIndex;
                    customDay.innerHTML = '<option value="">اختر اليوم</option>';
                    for (let i = 1; i <= 30; i++) customDay.innerHTML += `<option value="${i}">${i}</option>`;
                    customDay.value = day;
                }
                customYear.value = year;
            }
            const gregorianPicker = document.getElementById('conversion-gregorian-picker');
            const yearStr = date.getFullYear();
            const monthStr = String(date.getMonth() + 1).padStart(2, '0');
            const dayStr = String(date.getDate()).padStart(2, '0');
            gregorianPicker.value = `${yearStr}-${monthStr}-${dayStr}`;
            const mansion = getMansionInfo(baseIndex, baseGregYear);
            document.getElementById('conversion-mansion-info-rising').textContent = mansion ? `الطالع بالغداة: ${mansion["الطالع بالغداة"]}` : 'الطالع بالغداة: --';
            document.getElementById('conversion-mansion-info-setting').textContent = mansion ? `الغارب بالغداة: ${mansion["الغارب بالغداة"]}` : 'الغارب بالغداة: --';
            document.getElementById('conversion-mansion-info-quote').textContent = mansion ? `يقول ساجع العرب: ${mansion["يقول ساجع العرب"]}` : 'يقول ساجع العرب: --';
        }

        function handleConversionGregorianPicker() {
            const selectedDate = new Date(document.getElementById('conversion-gregorian-picker').value);
            let year = selectedDate.getFullYear();
            const calendarStart = new Date(year, 9, 16);
            if (selectedDate < calendarStart) year--;
            baseGregYear = year;
            const timeDiff = selectedDate - new Date(year, 9, 16);
            baseIndex = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
            document.getElementById('slider').value = baseIndex;
            updateConversionDisplay();
        }

        function handleConversionMuhammadanPicker() {
            const customMonth = document.getElementById('conversion-custom-month');
            const customDay = document.getElementById('conversion-custom-day');
            const customYear = document.getElementById('conversion-custom-year');
            const monthValue = customMonth.value;
            const dayValue = customDay.value;
            const yearValue = parseInt(customYear.value);
            if (monthValue === "" || dayValue === "" || isNaN(yearValue)) return;
            let index = monthValue === "special" ? 360 + (parseInt(dayValue) - 1) : parseInt(monthValue) * 30 + (parseInt(dayValue) - 1);
            if (monthValue === "special" && parseInt(dayValue) === 6 && !isLeapYear(yearValue - 1404 + 2024 + 1)) index = 364;
            let gregYear = yearValue - 1404 + 2024;
            let baseDate = new Date(gregYear, 9, 16);
            baseDate.setDate(baseDate.getDate() + index);
            let y = baseDate.getFullYear();
            const cs = new Date(y, 9, 16);
            baseGregYear = baseDate < cs ? y - 1 : y;
            baseIndex = index;
            document.getElementById('slider').value = baseIndex;
            isPickerChange = true;
            updateConversionDisplay();
            isPickerChange = false;
        }

        document.getElementById('time-slider').addEventListener('input', () => {
            const minutes = parseInt(document.getElementById('time-slider').value);
            const hours = Math.floor(minutes / 60);
            const mins = minutes % 60;
            const { date } = getCustomDate(todayIndex, todayGregYear);
            simulatedTime = new Date(date);
            simulatedTime.setHours(hours, mins, 0, 0);
            updateTodaySection();
        });

        document.getElementById('slider').addEventListener('input', () => {
            baseIndex = parseInt(document.getElementById('slider').value);
            const isEndYearLeap = isLeapYear(baseGregYear + 1);
            document.getElementById('slider').max = isEndYearLeap ? 365 : 364;
            if (baseIndex > document.getElementById('slider').max) baseIndex = document.getElementById('slider').max;
            document.getElementById('slider').value = baseIndex;
            updateConversionDisplay();
        });

        document.getElementById('prevYear').addEventListener('click', () => {
            baseGregYear--;
            const maxIndex = isLeapYear(baseGregYear + 1) ? 365 : 364;
            if (baseIndex > maxIndex) baseIndex = maxIndex;
            document.getElementById('slider').max = maxIndex;
            document.getElementById('slider').value = baseIndex;
            updateConversionDisplay();
        });

        document.getElementById('nextYear').addEventListener('click', () => {
            baseGregYear++;
            const maxIndex = isLeapYear(baseGregYear + 1) ? 365 : 364;
            if (baseIndex > maxIndex) baseIndex = maxIndex;
            document.getElementById('slider').max = maxIndex;
            document.getElementById('slider').value = baseIndex;
            updateConversionDisplay();
        });

        document.getElementById('prevCustomMonth').addEventListener('click', () => {
            const currentMonth = baseIndex >= 360 ? 12 : Math.floor(baseIndex / 30);
            let newMonth = currentMonth - 1;
            let newIndex = newMonth < 0 ? (baseGregYear--, 360) : newMonth * 30;
            baseIndex = newIndex;
            document.getElementById('slider').max = isLeapYear(baseGregYear + 1) ? 365 : 364;
            document.getElementById('slider').value = baseIndex;
            updateConversionDisplay();
        });

        document.getElementById('nextCustomMonth').addEventListener('click', () => {
            const currentMonth = baseIndex >= 360 ? 12 : Math.floor(baseIndex / 30);
            let newMonth = currentMonth + 1;
            let newIndex = newMonth === 12 ? 360 : newMonth > 12 ? (baseGregYear++, 0) : newMonth * 30;
            baseIndex = newIndex;
            document.getElementById('slider').max = isLeapYear(baseGregYear + 1) ? 365 : 364;
            document.getElementById('slider').value = baseIndex;
            updateConversionDisplay();
        });

        document.getElementById('prevDay').addEventListener('click', () => {
            baseIndex--;
            if (baseIndex < 0) {
                baseGregYear--;
                baseIndex = isLeapYear(baseGregYear + 1) ? 365 : 364;
            }
            document.getElementById('slider').max = isLeapYear(baseGregYear + 1) ? 365 : 364;
            document.getElementById('slider').value = baseIndex;
            updateConversionDisplay();
        });

        document.getElementById('nextDay').addEventListener('click', () => {
            const maxIndex = isLeapYear(baseGregYear + 1) ? 365 : 364;
            baseIndex++;
            if (baseIndex > maxIndex) {
                baseGregYear++;
                baseIndex = 0;
            }
            document.getElementById('slider').max = isLeapYear(baseGregYear + 1) ? 365 : 364;
            document.getElementById('slider').value = baseIndex;
            updateConversionDisplay();
        });

        document.getElementById('resetDay').addEventListener('click', () => {
            baseIndex = todayIndex;
            baseGregYear = todayGregYear;
            document.getElementById('slider').max = isLeapYear(baseGregYear + 1) ? 365 : 364;
            document.getElementById('slider').value = baseIndex;
            simulatedTime = null;
            document.getElementById('time-slider').value = 0;
            updateTodaySection();
            updateConversionDisplay();
        });

        document.getElementById('conversion-prevMansion').addEventListener('click', () => {
            const mansionInfo = getMansionInfo(baseIndex, baseGregYear);
            if (mansionInfo && mansionInfo.rangeIndex !== undefined) {
                let newMansionIndex = (mansionInfo.rangeIndex - 1 + mansions.length) % mansions.length;
                const newMansion = mansions[newMansionIndex];
                const baseDate = new Date(2024, 9, 16);
                const date = new Date(newMansion["التاريخ"]);
                const timeDiff = date - baseDate;
                baseIndex = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
                document.getElementById('slider').value = baseIndex;
                updateConversionDisplay();
            }
        });

        document.getElementById('conversion-nextMansion').addEventListener('click', () => {
            const mansionInfo = getMansionInfo(baseIndex, baseGregYear);
            if (mansionInfo && mansionInfo.rangeIndex !== undefined) {
                let newMansionIndex = (mansionInfo.rangeIndex + 1) % mansions.length;
                const newMansion = mansions[newMansionIndex];
                const baseDate = new Date(2024, 9, 16);
                const date = new Date(newMansion["التاريخ"]);
                const timeDiff = date - baseDate;
                baseIndex = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
                document.getElementById('slider').value = baseIndex;
                updateConversionDisplay();
            }
        });

        document.getElementById('conversion-gregorian-picker').addEventListener('change', handleConversionGregorianPicker);
        document.getElementById('conversion-custom-month').addEventListener('change', handleConversionMuhammadanPicker);
        document.getElementById('conversion-custom-day').addEventListener('change', handleConversionMuhammadanPicker);
        document.getElementById('conversion-custom-year').addEventListener('change', handleConversionMuhammadanPicker);
        document.getElementById('city-select').addEventListener('change', () => { updatePrayerTimes(); updateTodaySection(); });

        const { index, year } = getTodayIndexAndYear();
        todayIndex = index;
        todayGregYear = year;
        baseIndex = index;
        baseGregYear = year;
        document.getElementById('slider').max = isLeapYear(baseGregYear + 1) ? 365 : 364;
        document.getElementById('slider').value = baseIndex;
        populateConversionPickers();
        updateTodaySection();
        updatePrayerTimes();
        updateConversionDisplay();
        setInterval(() => { if (!simulatedTime) updateTodaySection(); }, 1000);
    </script>
</body>
</html>
